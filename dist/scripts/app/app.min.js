var treeDirective=angular.module("angularBootstrapNavTree",[]);treeDirective.directive("baTree",["$timeout",function(a){return{restrict:"E",templateUrl:"../views/baTree.html",replace:!0,require:"baTree",scope:{treeData:"=",selectedItem:"=",onSelect:"&",treeControl:"="},controller:function(b){var c=function(a){var c,d,e,f,g,h;c=function(b,d){var e,f,g,h,i;if(a(b,d),null!=b.children){for(h=b.children,i=[],f=0,g=h.length;g>f;f++)e=h[f],i.push(c(e,d+1));return i}};var i=b||i;for(g=i.treeData,h=[],e=0,f=g.length;f>e;e++)d=g[e],h.push(c(d,1));return h},d=function(a){var b;return b=void 0,a.parent_uid&&c(function(c){return c.uid===a.parent_uid?b=c:void 0}),b},e=function(a,b){var c;return c=d(a),null!=c?(b(c),e(c,b)):void 0},f=function(a){return e(a,function(a){return a.expanded=!0})};this.selected_branch=null,this.select_branch=function(c,d){if(console.log("branch: "+c),console.log("selected_branch: "+d),!c)return null!=this.selected_branch&&(this.selected_branch.selected=!1),void(this.selected_branch=null);if(c!==this.selected_branch){if(null!=this.selected_branch&&(this.selected_branch.selected=!1),c.selected=!0,this.selected_branch=c,f(c),null!=c.onSelect)return a(function(){return c.onSelect(c)});var e=b||e;if(null!=e.onSelect)return a(function(){return e.onSelect({branch:c})})}},this.get_parent=d,this.for_each_branch=c},link:function(a,b,c,d){var e=function(a,b){var c,d,e,f;"folder"==b?(c="3",d="glyphicon-folder-close",e="glyphicon-folder-open",f="glyphicon-folder-close"):"operator"==b&&(c="3",d="glyphicon-plus",e="glyphicon-minus",f="glyphicon-play"),null==a.iconExpand&&(a.iconExpand="glyphicon "+d),null==a.iconCollapse&&(a.iconCollapse="glyphicon "+e),null==a.iconLeaf&&(a.iconLeaf="glyphicon "+f),null==a.expandLevel&&(a.expandLevel=c)};e(c,c.pattern);var f=d.for_each_branch,g=d.get_parent,h=d.select_branch,i=parseInt(c.expandLevel,10);if(a.treeData){if(null==a.treeData.length){if(null==treeData.label)return void alert("treeData should be an array of root branches");a.treeData=[treeData]}var j=d.selected_branch;a.user_clicks_branch=function(b){console.log("user_clicks__branch_folder-------------------------------"),a.selectedItem.label=b.label,a.selectedItem.level=b.level,a.selectedItem.index=b.index;var c=b.branch;return c!==j?h(c,j):void 0};var k=function(){var b,d,e,g,h,i;for(f(function(a){return a.uid?void 0:a.uid=""+Math.random()}),console.log("UIDs are set."),f(function(a){var b,c,d,e,f;if(angular.isArray(a.children)){for(e=a.children,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(b.parent_uid=a.uid);return f}}),a.tree_rows=[],f(function(a){var b,c;return a.children?a.children.length>0?(c=function(a){return"string"==typeof a?{label:a,children:[]}:a},a.children=function(){var d,e,f,g;for(f=a.children,g=[],d=0,e=f.length;e>d;d++)b=f[d],g.push(c(b));return g}()):void 0:a.children=[]}),b=function(d,e,f,g){var h,i,j,g,k,l,m;if(null==e.expanded&&(e.expanded=!1),j=e.children&&0!==e.children.length?e.expanded?c.iconCollapse:c.iconExpand:c.iconLeaf,a.tree_rows.push({level:d,index:g||0,branch:e,label:e.label,tree_icon:j,visible:f}),null!=e.children){for(l=e.children,m=[],g=0,k=l.length;k>g;g++)h=l[g],i=f&&e.expanded,m.push(b(d+1,h,i,g));return m}},h=a.treeData,i=[],e=0,g=h.length;g>e;e++)d=h[e],i.push(b(1,d,!0));return i};a.$watch("treeData",k,!0);var l=a.treeData.length;if(console.log("num root branches = "+l),f(function(a,b){return a.level=b,a.expanded=a.level<i}),null!=a.treeControl&&angular.isObject(a.treeControl)){var m=a.treeControl;return m.expand_all=function(){return console.log("expand!"),f(function(a){return a.expanded=!0})},m.collapse_all=function(){return f(function(a){return a.expanded=!1})},m.get_first_branch=function(){return l=a.treeData.length,l>0?a.treeData[0]:void 0},m.select_first_branch=function(){var a;return a=m.get_first_branch(),m.select_branch(a)},m.get_selected_branch=function(){return j},m.get_parent_branch=function(a){return g(a)},m.select_branch=function(a){return h(a),a},m.get_children=function(a){return a.children},m.select_parent_branch=function(a){var b;return null==a&&(a=m.get_selected_branch()),null!=a&&(b=m.get_parent_branch(a),null!=b)?(m.select_branch(b),b):void 0},m.add_branch=function(b,c){return null!=b?(b.children.push(c),b.expanded=!0):a.treeData.push(c),c},m.add_root_branch=function(a){return m.add_branch(null,a),a},m.expand_branch=function(a){return null==a&&(a=m.get_selected_branch()),null!=a?(a.expanded=!0,a):void 0},m.collapse_branch=function(a){return null==a&&(a=j),null!=a?(a.expanded=!1,a):void 0},m.get_siblings=function(b){var c,d;return null==b&&(b=j),null!=b?(c=m.get_parent_branch(b),d=c?c.children:a.treeData):void 0},m.get_next_sibling=function(a){var b,c;return null==a&&(a=j),null!=a&&(c=m.get_siblings(a),l=c.length,b=c.indexOf(a),l>b)?c[b+1]:void 0},m.get_prev_sibling=function(a){var b,c;return null==a&&(a=j),c=m.get_siblings(a),l=c.length,b=c.indexOf(a),b>0?c[b-1]:void 0},m.select_next_sibling=function(a){var b;return null==a&&(a=j),null!=a&&(b=m.get_next_sibling(a),null!=b)?m.select_branch(b):void 0},m.select_prev_sibling=function(a){var b;return null==a&&(a=j),null!=a&&(b=m.get_prev_sibling(a),null!=b)?m.select_branch(b):void 0},m.get_first_child=function(a){var b;return null==a&&(a=j),null!=a&&(null!=(b=a.children)?b.length:void 0)>0?a.children[0]:void 0},m.get_closest_ancestor_next_sibling=function(a){var b,c;return b=m.get_next_sibling(a),null!=b?b:(c=m.get_parent_branch(a),m.get_closest_ancestor_next_sibling(c))},m.get_next_branch=function(a){var b;return null==a&&(a=j),null!=a?(b=m.get_first_child(a),null!=b?b:b=m.get_closest_ancestor_next_sibling(a)):void 0},m.select_next_branch=function(a){var b;return null==a&&(a=j),null!=a&&(b=m.get_next_branch(a),null!=b)?(m.select_branch(b),b):void 0},m.last_descendant=function(a){var b;return l=a.children.length,0===l?a:(b=a.children[l-1],m.last_descendant(b))},m.get_prev_branch=function(a){var b,c;return null==a&&(a=j),null!=a?(c=m.get_prev_sibling(a),null!=c?m.last_descendant(c):b=m.get_parent_branch(a)):void 0},m.select_prev_branch=function(a){var b;return null==a&&(a=j),null!=a&&(b=m.get_prev_branch(a),null!=b)?(m.select_branch(b),b):void 0}}}}}}]),treeDirective.directive("baCheckboxtree",["$timeout",function(a){return{restrict:"E",templateUrl:"../views/baCheckboxtree.html",replace:!0,scope:{treeData:"=",selectedItem:"=",column:"=",toggleSelect:"="},link:function(b){b.user_clicks_branch=function(c){console.log("user_clicks__branch_checkbox-------------------------------");var d=c.branch;b.selectedItem.label=d.label,b.selectedItem.level=c.level+1,b.selectedItem.index=c.index,b.selectedItem.prop=b.column,a(function(){b.toggleSelect(b.column)})};var c=function(){console.log("on_treeData_change!!!");var a,c,d,e,f,g;for(b.tree_rows=[],a=function(c,d,e,f){var g,h,f,i,j,k;if(b.tree_rows.push({branch:d,index:f||0,level:c,label:d.props[b.column],visible:e}),null!=d.children){for(j=d.children,k=[],f=0,i=j.length;i>f;f++)g=j[f],h=e&&d.expanded,k.push(a(c+1,g,h,f));return k}},f=b.treeData,g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(a(0,c,!0));return g};b.$watch("treeData",c,!0)}}}]);var dtfApp=angular.module("dtfApp",["ngRoute","ngAnimate","angularBootstrapNavTree"]);dtfApp.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/home.html"}).when("/Intergration Jobs",{templateUrl:"views/organizations_tree.html"}).otherwise({templateUrl:"views/404.html"})}]),dtfApp.controller("MainController",["$scope","$http","$timeout","$location",function(a,b,c,d){var e,f,g,h,i;a.my_tree=tree={};var j=function(){function d(b){a.my_data=b,a.prop_names=Object.keys(b[0].props),e=a.prop_names[1],f=a.prop_names[2],g=a.prop_names[3],h=a.prop_names[4],c(function(){tree.expand_all()},500)}i=JSON.parse(localStorage.getItem("savedData")),i?d(i):b.get("models/data.json").success(function(a){d(a)}),a.selectedItem={label:"",level:"",index:"",prop:""}};j(),a.jobs=[{label:"Desktop",children:[{}]},{label:"Intergrations",children:[{label:"Intergration Jobs"}]},{label:"Reporting",children:[{}]},{label:"Administration",children:[{}]}],a.lastRefreshDateTime="",a.lastSavedDateTime="";var k=function(b){d.path("/"+b),a.title=b},l=function(){var a=" ",b=new Date;a+=b.getFullYear()+"/",a+=b.getMonth()+1+"/",a+=b.getDate()+"  ",a+=b.getHours()+":";var c=b.getMinutes();return 10>c&&(c="0"+c),a+=c};a.toggleSelect=function(b){function d(a,c){for(var g=a.children,h=[],i=0,j=g.length;j>i;i++){var k=g[i].props;c==e&&f==i&&(k[b]=!k[b]),g[i].props=k,h.push({label:g[i].label,props:g[i].props,children:d(g[i],c+1)})}return h}console.log("toggleSelect");{var e=(a.selectedItem.label,a.selectedItem.level),f=a.selectedItem.index;a.selectedItem.prop}if(""==e)alert("Please select a row first");else{var g=[],h=a.my_data[0].props;1==e&&0==f&&(h[b]=!h[b]),a.my_data[0].props=h,g.push({label:a.my_data[0].label,props:a.my_data[0].props,children:d(a.my_data[0],2)}),a.my_data=g,c(function(){tree.expand_all()})}},a.refresh=function(){a.lastRefreshDateTime="Last Refreshed: "+l(),j()},a.save=function(){var b=JSON.stringify(a.my_data);localStorage.setItem("savedData",b),a.lastSavedDateTime="Last saved: "+l()},a.saveAndRun=function(){a.save(),k("schedule")},a.close=function(){k("close")},a.importOrganization=function(){a.toggleSelect(e)},a.importOrganizationAndUsers=function(){a.toggleSelect(e),a.toggleSelect(f)},a.obsoleteOrganization=function(){a.toggleSelect(g)},a.obsoleteUsers=function(){a.toggleSelect(h)},a.jobTreeHandler=function(a){var b=a.label;k(b),(b="Intergration Jobs")&&j()}}]);