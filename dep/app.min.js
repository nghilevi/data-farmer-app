var treeDirective=angular.module("angularBootstrapNavTree",[]);treeDirective.directive("baTree",["$timeout",function(e){return{restrict:"E",templateUrl:"baTree.html",replace:!0,require:"baTree",scope:{treeData:"=",selectedItem:"=",onSelect:"&",treeControl:"="},controller:["$scope",function(n){var t=function(e){var t,r,l,a,c,o;t=function(n,r){var l,a,c,o,i;if(e(n,r),null!=n.children){for(o=n.children,i=[],a=0,c=o.length;c>a;a++)l=o[a],i.push(t(l,r+1));return i}};var i=n||i;for(c=i.treeData,o=[],l=0,a=c.length;a>l;l++)r=c[l],o.push(t(r,1));return o},r=function(e){var n;return n=void 0,e.parent_uid&&t(function(t){return t.uid===e.parent_uid?n=t:void 0}),n},l=function(e,n){var t;return t=r(e),null!=t?(n(t),l(t,n)):void 0},a=function(e){return l(e,function(e){return e.expanded=!0})};this.selected_branch=null,this.select_branch=function(t,r){if(console.log("branch: "+t),console.log("selected_branch: "+r),!t)return null!=this.selected_branch&&(this.selected_branch.selected=!1),void(this.selected_branch=null);if(t!==this.selected_branch){if(null!=this.selected_branch&&(this.selected_branch.selected=!1),t.selected=!0,this.selected_branch=t,a(t),null!=t.onSelect)return e(function(){return t.onSelect(t)});var l=n||l;if(null!=l.onSelect)return e(function(){return l.onSelect({branch:t})})}},this.get_parent=r,this.for_each_branch=t}],link:function(e,n,t,r){var l=function(e,n){var t,r,l,a;"folder"==n?(t="3",r="glyphicon-folder-close",l="glyphicon-folder-open",a="glyphicon-folder-close"):"operator"==n&&(t="3",r="glyphicon-plus",l="glyphicon-minus",a="glyphicon-play"),null==e.iconExpand&&(e.iconExpand="glyphicon "+r),null==e.iconCollapse&&(e.iconCollapse="glyphicon "+l),null==e.iconLeaf&&(e.iconLeaf="glyphicon "+a),null==e.expandLevel&&(e.expandLevel=t)};l(t,t.pattern);var a=r.for_each_branch,c=r.get_parent,o=r.select_branch,i=parseInt(t.expandLevel,10);if(e.treeData){if(null==e.treeData.length){if(null==treeData.label)return void alert("treeData should be an array of root branches");e.treeData=[treeData]}var u=r.selected_branch;e.user_clicks_branch=function(n){console.log("user_clicks__branch_folder-------------------------------"),e.selectedItem.label=n.label,e.selectedItem.level=n.level,e.selectedItem.index=n.index;var t=n.branch;return t!==u?o(t,u):void 0};var s=function(){var n,r,l,c,o,i;for(a(function(e){return e.uid?void 0:e.uid=""+Math.random()}),console.log("UIDs are set."),a(function(e){var n,t,r,l,a;if(angular.isArray(e.children)){for(l=e.children,a=[],t=0,r=l.length;r>t;t++)n=l[t],a.push(n.parent_uid=e.uid);return a}}),e.tree_rows=[],a(function(e){var n,t;return e.children?e.children.length>0?(t=function(e){return"string"==typeof e?{label:e,children:[]}:e},e.children=function(){var r,l,a,c;for(a=e.children,c=[],r=0,l=a.length;l>r;r++)n=a[r],c.push(t(n));return c}()):void 0:e.children=[]}),n=function(r,l,a,c){var o,i,u,c,s,d,h;if(null==l.expanded&&(l.expanded=!1),u=l.children&&0!==l.children.length?l.expanded?t.iconCollapse:t.iconExpand:t.iconLeaf,e.tree_rows.push({level:r,index:c||0,branch:l,label:l.label,tree_icon:u,visible:a}),null!=l.children){for(d=l.children,h=[],c=0,s=d.length;s>c;c++)o=d[c],i=a&&l.expanded,h.push(n(r+1,o,i,c));return h}},o=e.treeData,i=[],l=0,c=o.length;c>l;l++)r=o[l],i.push(n(1,r,!0));return i};e.$watch("treeData",s,!0);var d=e.treeData.length;if(console.log("num root branches = "+d),a(function(e,n){return e.level=n,e.expanded=e.level<i}),null!=e.treeControl&&angular.isObject(e.treeControl)){var h=e.treeControl;return h.expand_all=function(){return console.log("expand!"),a(function(e){return e.expanded=!0})},h.collapse_all=function(){return a(function(e){return e.expanded=!1})},h.get_first_branch=function(){return d=e.treeData.length,d>0?e.treeData[0]:void 0},h.select_first_branch=function(){var e;return e=h.get_first_branch(),h.select_branch(e)},h.get_selected_branch=function(){return u},h.get_parent_branch=function(e){return c(e)},h.select_branch=function(e){return o(e),e},h.get_children=function(e){return e.children},h.select_parent_branch=function(e){var n;return null==e&&(e=h.get_selected_branch()),null!=e&&(n=h.get_parent_branch(e),null!=n)?(h.select_branch(n),n):void 0},h.add_branch=function(n,t){return null!=n?(n.children.push(t),n.expanded=!0):e.treeData.push(t),t},h.add_root_branch=function(e){return h.add_branch(null,e),e},h.expand_branch=function(e){return null==e&&(e=h.get_selected_branch()),null!=e?(e.expanded=!0,e):void 0},h.collapse_branch=function(e){return null==e&&(e=u),null!=e?(e.expanded=!1,e):void 0},h.get_siblings=function(n){var t,r;return null==n&&(n=u),null!=n?(t=h.get_parent_branch(n),r=t?t.children:e.treeData):void 0},h.get_next_sibling=function(e){var n,t;return null==e&&(e=u),null!=e&&(t=h.get_siblings(e),d=t.length,n=t.indexOf(e),d>n)?t[n+1]:void 0},h.get_prev_sibling=function(e){var n,t;return null==e&&(e=u),t=h.get_siblings(e),d=t.length,n=t.indexOf(e),n>0?t[n-1]:void 0},h.select_next_sibling=function(e){var n;return null==e&&(e=u),null!=e&&(n=h.get_next_sibling(e),null!=n)?h.select_branch(n):void 0},h.select_prev_sibling=function(e){var n;return null==e&&(e=u),null!=e&&(n=h.get_prev_sibling(e),null!=n)?h.select_branch(n):void 0},h.get_first_child=function(e){var n;return null==e&&(e=u),null!=e&&(null!=(n=e.children)?n.length:void 0)>0?e.children[0]:void 0},h.get_closest_ancestor_next_sibling=function(e){var n,t;return n=h.get_next_sibling(e),null!=n?n:(t=h.get_parent_branch(e),h.get_closest_ancestor_next_sibling(t))},h.get_next_branch=function(e){var n;return null==e&&(e=u),null!=e?(n=h.get_first_child(e),null!=n?n:n=h.get_closest_ancestor_next_sibling(e)):void 0},h.select_next_branch=function(e){var n;return null==e&&(e=u),null!=e&&(n=h.get_next_branch(e),null!=n)?(h.select_branch(n),n):void 0},h.last_descendant=function(e){var n;return d=e.children.length,0===d?e:(n=e.children[d-1],h.last_descendant(n))},h.get_prev_branch=function(e){var n,t;return null==e&&(e=u),null!=e?(t=h.get_prev_sibling(e),null!=t?h.last_descendant(t):n=h.get_parent_branch(e)):void 0},h.select_prev_branch=function(e){var n;return null==e&&(e=u),null!=e&&(n=h.get_prev_branch(e),null!=n)?(h.select_branch(n),n):void 0}}}}}}]),treeDirective.directive("baCheckboxtree",["$timeout",function(e){return{restrict:"E",templateUrl:"baCheckboxtree.html",replace:!0,scope:{treeData:"=",selectedItem:"=",column:"=",toggleSelect:"="},link:function(n){n.user_clicks_branch=function(t){console.log("user_clicks__branch_checkbox-------------------------------");var r=t.branch;n.selectedItem.label=r.label,n.selectedItem.level=t.level+1,n.selectedItem.index=t.index,n.selectedItem.prop=n.column,e(function(){n.toggleSelect(n.column)})};var t=function(){console.log("on_treeData_change!!!");var e,t,r,l,a,c;for(n.tree_rows=[],e=function(t,r,l,a){var c,o,a,i,u,s;if(n.tree_rows.push({branch:r,index:a||0,level:t,label:r.props[n.column],visible:l}),null!=r.children){for(u=r.children,s=[],a=0,i=u.length;i>a;a++)c=u[a],o=l&&r.expanded,s.push(e(t+1,c,o,a));return s}},a=n.treeData,c=[],r=0,l=a.length;l>r;r++)t=a[r],c.push(e(0,t,!0));return c};n.$watch("treeData",t,!0)}}}]);var dtfApp=angular.module("dtfApp",["ngRoute","ngAnimate","angularBootstrapNavTree"]);dtfApp.config(["$routeProvider",function(e){e.when("/",{templateUrl:"home.html"}).when("/Intergration Jobs",{templateUrl:"organizations_tree.html"}).otherwise({templateUrl:"404.html"})}]),dtfApp.controller("MainController",["$scope","$http","$timeout","$location",function(e,n,t,r){var l,a,c,o,i;e.my_tree=tree={};var u=function(){function r(n){e.my_data=n,e.prop_names=Object.keys(n[0].props),l=e.prop_names[1],a=e.prop_names[2],c=e.prop_names[3],o=e.prop_names[4],t(function(){tree.expand_all()},500)}i=JSON.parse(localStorage.getItem("savedData")),i?r(i):n.get("models/data.json").success(function(e){r(e)}),e.selectedItem={label:"",level:"",index:"",prop:""}};u(),e.jobs=[{label:"Desktop",children:[{}]},{label:"Intergrations",children:[{label:"Intergration Jobs"}]},{label:"Reporting",children:[{}]},{label:"Administration",children:[{}]}],e.lastRefreshDateTime="",e.lastSavedDateTime="";var s=function(n){r.path("/"+n),e.title=n},d=function(){var e=" ",n=new Date;e+=n.getFullYear()+"/",e+=n.getMonth()+1+"/",e+=n.getDate()+"  ",e+=n.getHours()+":";var t=n.getMinutes();return 10>t&&(t="0"+t),e+=t};e.toggleSelect=function(n){function r(e,t){for(var c=e.children,o=[],i=0,u=c.length;u>i;i++){var s=c[i].props;t==l&&a==i&&(s[n]=!s[n]),c[i].props=s,o.push({label:c[i].label,props:c[i].props,children:r(c[i],t+1)})}return o}console.log("toggleSelect");{var l=(e.selectedItem.label,e.selectedItem.level),a=e.selectedItem.index;e.selectedItem.prop}if(""==l)alert("Please select a row first");else{var c=[],o=e.my_data[0].props;1==l&&0==a&&(o[n]=!o[n]),e.my_data[0].props=o,c.push({label:e.my_data[0].label,props:e.my_data[0].props,children:r(e.my_data[0],2)}),e.my_data=c,t(function(){tree.expand_all()})}},e.refresh=function(){e.lastRefreshDateTime="Last Refreshed: "+d(),u()},e.save=function(){var n=JSON.stringify(e.my_data);localStorage.setItem("savedData",n),e.lastSavedDateTime="Last saved: "+d()},e.saveAndRun=function(){e.save(),s("schedule")},e.close=function(){s("close")},e.importOrganization=function(){e.toggleSelect(l)},e.importOrganizationAndUsers=function(){e.toggleSelect(l),e.toggleSelect(a)},e.obsoleteOrganization=function(){e.toggleSelect(c)},e.obsoleteUsers=function(){e.toggleSelect(o)},e.jobTreeHandler=function(e){var n=e.label;s(n),(n="Intergration Jobs")&&u()}}]);